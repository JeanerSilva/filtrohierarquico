var hierarchicalfilterwithsearchwrapef1b0c7a;(()=>{"use strict";var e={361:(e,t,s)=>{s.r(t)},611:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VisualSettings=t.BehaviorSettings=t.SearchSettings=t.ItemTextSettings=t.TitleSettings=void 0;class s{constructor(){this.show=!0,this.text="Filtro",this.fontSize=14}}t.TitleSettings=s;class i{constructor(){this.fontSize=16,this.wrapWidth=1260,this.indent=14}}t.ItemTextSettings=i;class l{constructor(){this.show=!0,this.placeholder="Pesquisar..."}}t.SearchSettings=l;class n{constructor(){this.leavesOnly=!1,this.singleSelect=!1}}t.BehaviorSettings=n;class r{constructor(){this.title=new s,this.itemText=new i,this.search=new l,this.behavior=new n}static parse(e,t){var s;const i=t?(l=t,JSON.parse(JSON.stringify(l))):new r;var l;const n=null===(s=null==e?void 0:e.metadata)||void 0===s?void 0:s.objects;if(!n)return i;const a=(e,t)=>e&&Object.prototype.hasOwnProperty.call(e,t),h=(e,t)=>{const s="number"==typeof e?e:Number(e);return Number.isFinite(s)?s:t},c=(e,t)=>"boolean"==typeof e?e:t,o=(e,t)=>"string"==typeof e?e:null==e?t:String(e);if(a(n,"title")){const e=n.title;a(e,"show")&&(i.title.show=c(e.show,i.title.show)),a(e,"text")&&(i.title.text=o(e.text,i.title.text)),a(e,"fontSize")&&(i.title.fontSize=h(e.fontSize,i.title.fontSize))}if(a(n,"itemText")){const e=n.itemText;a(e,"fontSize")&&(i.itemText.fontSize=h(e.fontSize,i.itemText.fontSize)),a(e,"wrapWidth")&&(i.itemText.wrapWidth=h(e.wrapWidth,i.itemText.wrapWidth)),a(e,"indent")&&(i.itemText.indent=h(e.indent,i.itemText.indent))}if(a(n,"search")){const e=n.search;a(e,"show")&&(i.search.show=c(e.show,i.search.show)),a(e,"placeholder")&&(i.search.placeholder=o(e.placeholder,i.search.placeholder))}if(a(n,"behavior")){const e=n.behavior;a(e,"leavesOnly")&&(i.behavior.leavesOnly=c(e.leavesOnly,i.behavior.leavesOnly)),a(e,"singleSelect")&&(i.behavior.singleSelect=c(e.singleSelect,i.behavior.singleSelect))}return i}}t.VisualSettings=r},922:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Visual=void 0,s(361);const i=s(611);t.Visual=class{constructor(e){this.settings=new i.VisualSettings,this.allNodes=[],this.filteredNodes=[],this.expandedKeys=new Set,this.selectedNodeKeys=new Set,this.currentSelectedKey=null,this.host=e.host,this.selectionManager=this.host.createSelectionManager(),this.target=e.element,this.container=document.createElement("div"),this.container.className="hf__root",this.target.appendChild(this.container),this.titleEl=document.createElement("div"),this.titleEl.className="hf__title",this.container.appendChild(this.titleEl),this.searchWrap=document.createElement("div"),this.searchWrap.className="hf__search",this.container.appendChild(this.searchWrap),this.treeWrap=document.createElement("div"),this.treeWrap.className="hf__tree",this.container.appendChild(this.treeWrap)}update(e){var t;const s=e.dataViews&&e.dataViews[0];s&&((null===(t=s.metadata)||void 0===t?void 0:t.objects)&&(this.settings=i.VisualSettings.parse(s,this.settings)),this.container.style.fontSize=`${this.settings.itemText.fontSize}px`,this.titleEl.style.display=this.settings.title.show?"block":"none",this.titleEl.textContent=this.settings.title.text,this.titleEl.style.fontSize=`${this.settings.title.fontSize}px`,this.renderSearch(),this.allNodes=this.buildTree(s),this.filteredNodes=this.allNodes,0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.renderTree(),this.ensureSingleSelected(),this.applySelection())}clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}isSelectable(e){const t=!e.children||0===e.children.length;return e.selectionIds.length>0&&(t||!this.settings.behavior.leavesOnly)}findFirstSelectable(e){var t;for(const s of e){if(this.isSelectable(s))return s;if(null===(t=s.children)||void 0===t?void 0:t.length){const e=this.findFirstSelectable(s.children);if(e)return e}}return null}nodeIsSelected(e){return this.selectedNodeKeys.has(e)}collectSelectedIds(){const e=[],t=s=>{var i;for(const l of s){if(this.selectedNodeKeys.has(l.key))for(const t of l.selectionIds)e.push(t);(null===(i=l.children)||void 0===i?void 0:i.length)&&t(l.children)}};return t(this.filteredNodes),e}applySelection(){const e=this.collectSelectedIds();0===e.length?this.selectionManager.clear():this.selectionManager.select(e,!1)}ensureSingleSelected(){if(this.settings.behavior.singleSelect&&0===this.selectedNodeKeys.size){const e=this.findFirstSelectable(this.filteredNodes);if(e){this.selectedNodeKeys.add(e.key),this.currentSelectedKey=e.key;const t=this.treeWrap.querySelector(`input[data-key="${e.key}"]`);t&&(t.checked=!0)}}}buildTree(e){var t;const s=null===(t=e.categorical)||void 0===t?void 0:t.categories;if(!s||0===s.length)return[];const i=s.findIndex(e=>Array.isArray(e.identity)&&e.identity.length>0),l=i>=0?s[i]:null,n=s[0].values.length,r=new Map,a=[],h=e=>String(null!=e?e:""),c=(e,t)=>{const i=[];for(let l=0;l<=t;l++)i.push(`${l}:${h(s[l].values[e])}`);return i.join("|")};for(let e=0;e<n;e++){let t;for(let i=0;i<s.length;i++){const n=h(s[i].values[e]),o=c(e,i);let d=r.get(o);if(!d)if(d={key:o,value:n,level:i,identity:s[i].identity?this.host.createSelectionIdBuilder().withCategory(s[i],e).createSelectionId():null,selectionIds:[],children:[],parentKey:t},r.set(o,d),0===i)a.push(d);else if(t){const e=r.get(t);e&&e.children.push(d)}if(l){const t=this.host.createSelectionIdBuilder().withCategory(l,e).createSelectionId();d.selectionIds.some(e=>!!e.equals&&e.equals(t))||d.selectionIds.push(t)}t=o}}return a}renderSearch(){if(this.clearElement(this.searchWrap),!this.settings.search.show)return;const e=document.createElement("div");e.style.display="flex",e.style.gap="4px",e.style.alignItems="center";const t=document.createElement("input");t.type="text",t.className="hf__search__input",t.placeholder=this.settings.search.placeholder||"Pesquisar...",t.style.flex="1",t.addEventListener("input",()=>{const e=t.value.trim().toLowerCase();this.filteredNodes=e?this.filterTree(this.allNodes,e):this.allNodes,0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.renderTree(),this.ensureSingleSelected(),this.applySelection()});const s=document.createElement("button");s.textContent="✕",s.title="Limpar filtro e seleção",s.style.cursor="pointer",s.addEventListener("click",()=>{if(t.value="",this.filteredNodes=this.allNodes,0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.selectedNodeKeys.clear(),this.currentSelectedKey=null,this.settings.behavior.singleSelect){const e=this.findFirstSelectable(this.filteredNodes);e&&(this.selectedNodeKeys.add(e.key),this.currentSelectedKey=e.key)}this.renderTree(),this.applySelection()}),e.appendChild(t),e.appendChild(s),this.searchWrap.appendChild(e)}filterTree(e,t){const s=e=>{const i=-1!==e.value.toLowerCase().indexOf(t),l=e.children.map(e=>s(e)).filter(e=>!!e);return i||l.length>0?{...e,children:l}:null},i=[];for(const t of e){const e=s(t);e&&i.push(e)}return i}renderTree(){this.clearElement(this.treeWrap);const e=(t,s)=>{var i,l;!t.children||t.children.length;const n=this.expandedKeys.has(t.key),r=document.createElement("div");if(r.className="hf__row",r.style.paddingLeft=t.level*(this.settings.itemText.indent||14)+"px",null===(i=t.children)||void 0===i?void 0:i.length){const e=document.createElement("span");e.className="hf__caret",e.textContent=n?"▾":"▸",e.addEventListener("click",e=>{e.stopPropagation(),n?this.expandedKeys.delete(t.key):this.expandedKeys.add(t.key),this.renderTree(),this.ensureSingleSelected(),this.applySelection()}),r.appendChild(e)}else{const e=document.createElement("span");e.className="hf__caret --empty",r.appendChild(e)}const a=this.isSelectable(t),h=this.settings.behavior.singleSelect?"radio":"checkbox";let c=null;if(a){const e=document.createElement("input");e.type=h,"radio"===h&&(e.name="hf-single-select-group"),e.className="hf__chk",e.dataset.key=t.key,e.checked=this.nodeIsSelected(t.key),c=e,r.appendChild(e)}const o=document.createElement("label");if(o.className="hf__lbl",o.textContent=t.value,o.style.maxWidth=`${this.settings.itemText.wrapWidth}px`,r.appendChild(o),s.appendChild(r),a){const e=()=>{this.settings.behavior.singleSelect?(this.selectedNodeKeys.clear(),this.selectedNodeKeys.add(t.key),this.currentSelectedKey=t.key):this.selectedNodeKeys.has(t.key)?this.selectedNodeKeys.delete(t.key):this.selectedNodeKeys.add(t.key),"radio"===c.type?c.checked=!0:c.checked=this.selectedNodeKeys.has(t.key),this.applySelection()};c.addEventListener("change",e),r.addEventListener("click",t=>{"input"!==t.target.tagName.toLowerCase()&&("radio"===c.type?c.checked=!0:c.checked=!c.checked,e())})}else r.style.cursor="default";if(null===(l=t.children)||void 0===l?void 0:l.length){const i=document.createElement("div");i.className="hf__kids",s.appendChild(i),n&&t.children.forEach(t=>e(t,i))}};this.filteredNodes.forEach(t=>e(t,this.treeWrap))}enumerateObjectInstances(e){const t=[],s=e=>{t.push(e)};switch(e.objectName){case"title":s({objectName:"title",properties:{show:this.settings.title.show,text:this.settings.title.text,fontSize:this.settings.title.fontSize}});break;case"itemText":s({objectName:"itemText",properties:{fontSize:this.settings.itemText.fontSize,wrapWidth:this.settings.itemText.wrapWidth,indent:this.settings.itemText.indent}});break;case"search":s({objectName:"search",properties:{show:this.settings.search.show,placeholder:this.settings.search.placeholder}});break;case"behavior":s({objectName:"behavior",properties:{leavesOnly:this.settings.behavior.leavesOnly,singleSelect:this.settings.behavior.singleSelect}})}return t}}}},t={};function s(i){var l=t[i];if(void 0!==l)return l.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0});const t=s(922);var l=window.powerbi,n={name:"hierarchicalfilterwithsearchwrapef1b0c7a",displayName:"Hierarchical Filter (with Search & Wrap)",class:"Visual",apiVersion:"5.11.0",create:e=>{if(t.Visual)return new t.Visual(e);throw"Visual instance not found"},createModalDialog:(e,t,s)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,s)},custom:!0};void 0!==l&&(l.visuals=l.visuals||{},l.visuals.plugins=l.visuals.plugins||{},l.visuals.plugins.hierarchicalfilterwithsearchwrapef1b0c7a=n),e.default=n})(),hierarchicalfilterwithsearchwrapef1b0c7a=i})();