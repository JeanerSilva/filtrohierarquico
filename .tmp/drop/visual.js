var hierarchicalfilterwithsearchwrapef1b0c7a;(()=>{"use strict";var e={361:(e,t,s)=>{s.r(t)},611:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VisualSettings=t.BehaviorSettings=t.SearchSettings=t.ItemTextSettings=t.TitleSettings=void 0;class s{constructor(){this.show=!0,this.text="Filtro",this.fontSize=14}}t.TitleSettings=s;class i{constructor(){this.fontSize=16,this.wrapWidth=1260,this.indent=14}}t.ItemTextSettings=i;class l{constructor(){this.show=!0,this.placeholder="Pesquisar..."}}t.SearchSettings=l;class r{constructor(){this.leavesOnly=!1,this.singleSelect=!1}}t.BehaviorSettings=r;class n{constructor(){this.title=new s,this.itemText=new i,this.search=new l,this.behavior=new r}static parse(e,t){var s;const i=t?(l=t,JSON.parse(JSON.stringify(l))):new n;var l;const r=null===(s=null==e?void 0:e.metadata)||void 0===s?void 0:s.objects;if(!r)return i;const a=(e,t)=>e&&Object.prototype.hasOwnProperty.call(e,t),h=(e,t)=>{const s="number"==typeof e?e:Number(e);return Number.isFinite(s)?s:t},o=(e,t)=>"boolean"==typeof e?e:t,c=(e,t)=>"string"==typeof e?e:null==e?t:String(e);if(a(r,"title")){const e=r.title;a(e,"show")&&(i.title.show=o(e.show,i.title.show)),a(e,"text")&&(i.title.text=c(e.text,i.title.text)),a(e,"fontSize")&&(i.title.fontSize=h(e.fontSize,i.title.fontSize))}if(a(r,"itemText")){const e=r.itemText;a(e,"fontSize")&&(i.itemText.fontSize=h(e.fontSize,i.itemText.fontSize)),a(e,"wrapWidth")&&(i.itemText.wrapWidth=h(e.wrapWidth,i.itemText.wrapWidth)),a(e,"indent")&&(i.itemText.indent=h(e.indent,i.itemText.indent))}if(a(r,"search")){const e=r.search;a(e,"show")&&(i.search.show=o(e.show,i.search.show)),a(e,"placeholder")&&(i.search.placeholder=c(e.placeholder,i.search.placeholder))}if(a(r,"behavior")){const e=r.behavior;a(e,"leavesOnly")&&(i.behavior.leavesOnly=o(e.leavesOnly,i.behavior.leavesOnly)),a(e,"singleSelect")&&(i.behavior.singleSelect=o(e.singleSelect,i.behavior.singleSelect))}return i}}t.VisualSettings=n},922:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Visual=void 0,s(361);const i=s(611);t.Visual=class{constructor(e){this.settings=new i.VisualSettings,this.allNodes=[],this.filteredNodes=[],this.expandedKeys=new Set,this.selectedNodeKeys=new Set,this.currentSelectedKey=null,this.searchQuery="",this.lastAppliedSig="",this.allowAutoPick=!1,this.lastDataSig="",this.host=e.host,this.selectionManager=this.host.createSelectionManager(),this.target=e.element,this.container=document.createElement("div"),this.container.className="hf__root",this.target.appendChild(this.container),this.titleEl=document.createElement("div"),this.titleEl.className="hf__title",this.container.appendChild(this.titleEl),this.searchWrap=document.createElement("div"),this.searchWrap.className="hf__search",this.container.appendChild(this.searchWrap),this.treeWrap=document.createElement("div"),this.treeWrap.className="hf__tree",this.container.appendChild(this.treeWrap)}update(e){var t;const s=e.dataViews&&e.dataViews[0];if(!s)return;(null===(t=s.metadata)||void 0===t?void 0:t.objects)&&(this.settings=i.VisualSettings.parse(s,this.settings)),this.container.style.fontSize=`${this.settings.itemText.fontSize}px`,this.titleEl.style.display=this.settings.title.show?"block":"none",this.titleEl.textContent=this.settings.title.text,this.titleEl.style.fontSize=`${this.settings.title.fontSize}px`,this.allNodes=this.buildTree(s);const l=this.dataSignature(this.allNodes),r=l!==this.lastDataSig;this.lastDataSig=l;const n=this.searchQuery.trim().toLowerCase();this.filteredNodes=n?this.filterTree(this.allNodes,n):this.allNodes,r&&n&&0===this.filteredNodes.length&&(this.searchQuery="",this.filteredNodes=this.allNodes,this.expandedKeys.clear(),this.currentSelectedKey=null),this.renderSearch();const a=new Set;this.walkNodes(this.filteredNodes,e=>a.add(e.key));for(const e of Array.from(this.expandedKeys))a.has(e)||this.expandedKeys.delete(e);for(const e of Array.from(this.selectedNodeKeys))a.has(e)||this.selectedNodeKeys.delete(e);this.currentSelectedKey&&!a.has(this.currentSelectedKey)&&(this.currentSelectedKey=null),0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.renderTree(),this.ensureSingleSelected(!1),this.applySelection(!1)}clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}walkNodes(e,t){var s;for(const i of e)t(i),(null===(s=i.children)||void 0===s?void 0:s.length)&&this.walkNodes(i.children,t)}isSelectable(e){const t=!e.children||0===e.children.length;return e.selectionIds.length>0&&(t||!this.settings.behavior.leavesOnly)}findFirstSelectable(e){var t;for(const s of e){if(this.isSelectable(s))return s;if(null===(t=s.children)||void 0===t?void 0:t.length){const e=this.findFirstSelectable(s.children);if(e)return e}}return null}collectSelectedIds(){const e=[],t=s=>{var i;for(const l of s){if(this.selectedNodeKeys.has(l.key))for(const t of l.selectionIds)e.push(t);(null===(i=l.children)||void 0===i?void 0:i.length)&&t(l.children)}};return t(this.filteredNodes),e}selectionSignature(e){return Array.from(e).sort().join("|")}dataSignature(e){return e.map(e=>`${e.level}:${e.value}`).sort().join("||")}applySelection(e=!1){const t=this.collectSelectedIds();e&&(0===t.length?this.selectionManager.clear():this.selectionManager.select(t,!0))}ensureSingleSelected(e){if(!this.settings.behavior.singleSelect)return;if(this.selectedNodeKeys.size>0)return;if(!e)return;const t=this.findFirstSelectable(this.filteredNodes);if(t){this.selectedNodeKeys.clear(),this.selectedNodeKeys.add(t.key),this.currentSelectedKey=t.key;const e=this.treeWrap.querySelector(`input[data-key="${t.key}"]`);e&&(e.checked=!0)}}buildTree(e){var t;const s=null===(t=e.categorical)||void 0===t?void 0:t.categories;if(!s||0===s.length)return[];let i=-1;for(let e=s.length-1;e>=0;e--)if(Array.isArray(s[e].identity)&&s[e].identity.length>0){i=e;break}const l=i>=0?s[i]:null,r=s[0].values.length,n=new Map,a=[],h=e=>String(null!=e?e:""),o=(e,t)=>{const i=[];for(let l=0;l<=t;l++)i.push(`${l}:${h(s[l].values[e])}`);return i.join("|")};for(let e=0;e<r;e++){let t;for(let i=0;i<s.length;i++){const r=h(s[i].values[e]),c=o(e,i);let d=n.get(c);if(!d)if(d={key:c,value:r,level:i,identity:s[i].identity?this.host.createSelectionIdBuilder().withCategory(s[i],e).createSelectionId():null,selectionIds:[],children:[],parentKey:t},n.set(c,d),0===i)a.push(d);else if(t){const e=n.get(t);e&&e.children.push(d)}if(l){const t=this.host.createSelectionIdBuilder().withCategory(l,e).createSelectionId();d.selectionIds.some(e=>!!e.equals&&e.equals(t))||d.selectionIds.push(t)}t=c}}return a}renderSearch(){if(this.clearElement(this.searchWrap),!this.settings.search.show)return;const e=document.createElement("div");e.style.display="flex",e.style.gap="4px",e.style.alignItems="center";const t=document.createElement("input");t.type="text",t.className="hf__search__input",t.placeholder=this.settings.search.placeholder||"Pesquisar...",t.style.flex="1",t.value=this.searchQuery;const s=()=>{const e=this.searchQuery.trim().toLowerCase();this.filteredNodes=e?this.filterTree(this.allNodes,e):this.allNodes,0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.renderTree(),this.allowAutoPick=!0,this.ensureSingleSelected(!0),this.applySelection(!0),this.allowAutoPick=!1};t.addEventListener("input",()=>{this.searchQuery=t.value,s()});const i=document.createElement("button");i.textContent="✕",i.title="Limpar filtro e seleção",i.style.cursor="pointer",i.addEventListener("click",()=>{this.searchQuery="",t.value="",this.filteredNodes=this.allNodes,this.expandedKeys.clear(),this.selectedNodeKeys.clear(),this.currentSelectedKey=null,this.renderTree(),this.allowAutoPick=!0,this.ensureSingleSelected(!0),this.applySelection(!0),this.allowAutoPick=!1}),e.appendChild(t),e.appendChild(i),this.searchWrap.appendChild(e)}filterTree(e,t){const s=e=>{const i=-1!==e.value.toLowerCase().indexOf(t),l=e.children.map(e=>s(e)).filter(e=>!!e);return i||l.length>0?{...e,children:l}:null},i=[];for(const t of e){const e=s(t);e&&i.push(e)}return i}renderTree(){this.clearElement(this.treeWrap);const e=(t,s)=>{var i,l;!t.children||t.children.length;const r=this.expandedKeys.has(t.key),n=document.createElement("div");if(n.className="hf__row",n.style.paddingLeft=t.level*(this.settings.itemText.indent||14)+"px",null===(i=t.children)||void 0===i?void 0:i.length){const e=document.createElement("span");e.className="hf__caret",e.textContent=r?"▾":"▸",e.addEventListener("click",e=>{e.stopPropagation(),r?this.expandedKeys.delete(t.key):this.expandedKeys.add(t.key),this.renderTree()}),n.appendChild(e)}else{const e=document.createElement("span");e.className="hf__caret --empty",n.appendChild(e)}const a=this.isSelectable(t),h=this.settings.behavior.singleSelect?"radio":"checkbox";let o=null;if(a){const e=document.createElement("input");e.type=h,"radio"===h&&(e.name="hf-single-select-group"),e.className="hf__chk",e.dataset.key=t.key,e.checked=this.selectedNodeKeys.has(t.key),o=e,n.appendChild(e)}const c=document.createElement("label");if(c.className="hf__lbl",c.textContent=t.value,c.style.maxWidth=`${this.settings.itemText.wrapWidth}px`,n.appendChild(c),s.appendChild(n),a){const e=()=>{this.settings.behavior.singleSelect&&this.selectedNodeKeys.has(t.key)?o&&(o.checked=!0):(this.settings.behavior.singleSelect?(this.selectedNodeKeys.clear(),this.selectedNodeKeys.add(t.key),this.currentSelectedKey=t.key):this.selectedNodeKeys.has(t.key)?this.selectedNodeKeys.delete(t.key):this.selectedNodeKeys.add(t.key),"radio"===o.type?o.checked=!0:o.checked=this.selectedNodeKeys.has(t.key),this.allowAutoPick=!0,this.ensureSingleSelected(!0),this.applySelection(!0),this.allowAutoPick=!1)};o.addEventListener("change",e),n.addEventListener("click",s=>{if("input"!==s.target.tagName.toLowerCase()){if("radio"===o.type&&this.selectedNodeKeys.has(t.key))return void(o.checked=!0);"radio"===o.type?o.checked=!0:o.checked=!o.checked,e()}})}else n.style.cursor="default";if(null===(l=t.children)||void 0===l?void 0:l.length){const i=document.createElement("div");i.className="hf__kids",s.appendChild(i),r&&t.children.forEach(t=>e(t,i))}};0===this.expandedKeys.size&&this.filteredNodes.forEach(e=>this.expandedKeys.add(e.key)),this.filteredNodes.forEach(t=>e(t,this.treeWrap))}enumerateObjectInstances(e){const t=[],s=e=>{t.push(e)};switch(e.objectName){case"title":s({objectName:"title",properties:{show:this.settings.title.show,text:this.settings.title.text,fontSize:this.settings.title.fontSize}});break;case"itemText":s({objectName:"itemText",properties:{fontSize:this.settings.itemText.fontSize,wrapWidth:this.settings.itemText.wrapWidth,indent:this.settings.itemText.indent}});break;case"search":s({objectName:"search",properties:{show:this.settings.search.show,placeholder:this.settings.search.placeholder}});break;case"behavior":s({objectName:"behavior",properties:{leavesOnly:this.settings.behavior.leavesOnly,singleSelect:this.settings.behavior.singleSelect}})}return t}}}},t={};function s(i){var l=t[i];if(void 0!==l)return l.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0});const t=s(922);var l=window.powerbi,r={name:"hierarchicalfilterwithsearchwrapef1b0c7a",displayName:"Hierarchical Filter (with Search & Wrap)",class:"Visual",apiVersion:"5.11.0",create:e=>{if(t.Visual)return new t.Visual(e);throw"Visual instance not found"},createModalDialog:(e,t,s)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,s)},custom:!0};void 0!==l&&(l.visuals=l.visuals||{},l.visuals.plugins=l.visuals.plugins||{},l.visuals.plugins.hierarchicalfilterwithsearchwrapef1b0c7a=r),e.default=r})(),hierarchicalfilterwithsearchwrapef1b0c7a=i})();